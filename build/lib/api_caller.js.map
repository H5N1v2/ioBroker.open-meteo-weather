{
  "version": 3,
  "sources": ["../../src/lib/api_caller.ts"],
  "sourcesContent": ["// api_caller.ts\nimport axios from 'axios';\n/**\n * Konfiguration f\u00FCr den Wetter-API-Abruf\n */\nexport interface WeatherConfig {\n\t/** Breitengrad */\n\tlatitude: number;\n\t/** L\u00E4ngengrad */\n\tlongitude: number;\n\t/** Anzahl der Vorhersagetage */\n\tforecastDays: number;\n\t/** Anzahl der Vorhersagestunden */\n\tforecastHours: number;\n\t/** Ob st\u00FCndliche Vorhersage aktiviert ist */\n\tforecastHoursEnabled: boolean;\n\t/** Ob Luftqualit\u00E4tsdaten abgerufen werden sollen */\n\tairQualityEnabled: boolean;\n\t/** Ob Luftqualtit\u00E4t Tage abgerufen werden sollen */\n\tairQualityForecastDays: number;\n\t/** Die Zeitzone (z.B. Europe/Berlin) */\n\ttimezone: string;\n\t/** Ob imperiale Einheiten genutzt werden sollen */\n\tisImperial: boolean;\n}\n\n/**\n * Holt alle Wetter- und Luftqualit\u00E4tsdaten von der Open-Meteo API\n *\n * @param config Die Konfiguration f\u00FCr den Abruf\n * @param logger Optionaler ioBroker Logger f\u00FCr Debug-Ausgaben\n * @returns Die abgerufenen Wetterdaten als Objekt\n */\nexport async function fetchAllWeatherData(config: WeatherConfig, logger?: ioBroker.Logger): Promise<any> {\n\tconst tz = encodeURIComponent(config.timezone);\n\tconst results: any = {};\n\n\t// Axios-Konfiguration f\u00FCr Performance und Stabilit\u00E4t\n\tconst axiosConfig = {\n\t\ttimeout: 15000,\n\t\theaders: {\n\t\t\tConnection: 'close',\n\t\t},\n\t};\n\n\t// Imperiale Parameter vorbereiten\n\tconst unitParams = config.isImperial\n\t\t? '&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch'\n\t\t: '';\n\n\tlet fHoursParam = '';\n\tlet fHoursParam_keys = '';\n\n\tif (config.forecastHoursEnabled) {\n\t\tconst totalHours = config.forecastHours;\n\t\tfHoursParam = `&forecast_hours=${totalHours}`;\n\t\tfHoursParam_keys = `&hourly=temperature_2m,relative_humidity_2m,dew_point_2m,precipitation_probability,precipitation,et0_fao_evapotranspiration,rain,weather_code,pressure_msl,cloud_cover,wind_speed_10m,wind_direction_10m,wind_gusts_10m,soil_temperature_0cm,uv_index,sunshine_duration,is_day,snowfall,snow_depth,global_tilted_irradiance`;\n\t}\n\tconst currentparam_keys =\n\t\t'temperature_2m,relative_humidity_2m,pressure_msl,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,wind_gusts_10m,is_day';\n\n\tconst dailyparam_keys =\n\t\t'relative_humidity_2m_mean,weather_code,temperature_2m_max,temperature_2m_min,pressure_msl_mean,sunrise,sunshine_duration,sunset,uv_index_max,precipitation_sum,rain_sum,snowfall_sum,precipitation_probability_max,et0_fao_evapotranspiration_sum,cloud_cover_max,wind_speed_10m_max,wind_direction_10m_dominant,wind_gusts_10m_max,dew_point_2m_mean';\n\n\t// URL mit unitParams erweitern\n\tconst weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${config.latitude}&longitude=${config.longitude}&current=${currentparam_keys}&daily=${dailyparam_keys}${fHoursParam_keys}&timezone=${tz}&forecast_days=${config.forecastDays}${fHoursParam}${unitParams}`;\n\n\tif (logger) {\n\t\tlogger.debug(`Open-Meteo Weather URL: ${weatherUrl}`);\n\t}\n\n\ttry {\n\t\tconst resW = await axios.get(weatherUrl, axiosConfig);\n\n\t\tif (logger) {\n\t\t\tlogger.debug(`Open-Meteo Weather Response Status: ${resW.status}`);\n\t\t}\n\n\t\tresults.weather = resW.data;\n\n\t\tif (resW.data.hourly) {\n\t\t\tresults.hourly = resW.data;\n\t\t}\n\t} catch (error: any) {\n\t\tif (logger) {\n\t\t\tlogger.error(`Error retrieving weather data: ${error.message}`);\n\t\t}\n\t\tthrow new Error(`Weather API request failed: ${error.message}`);\n\t}\n\n\tconst pollenparam_keys =\n\t\t'pm10,pm2_5,nitrogen_dioxide,alder_pollen,birch_pollen,grass_pollen,mugwort_pollen,ragweed_pollen,carbon_monoxide,dust,olive_pollen,ozone';\n\tconst pollenparam_keys_hourly = `&hourly=${pollenparam_keys}`;\n\tif (config.airQualityEnabled) {\n\t\tconst airUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${config.latitude}&longitude=${config.longitude}&current=european_aqi,${pollenparam_keys}${pollenparam_keys_hourly}&timezone=${tz}&forecast_days=${config.forecastDays > 7 ? 7 : config.forecastDays}`;\n\n\t\tif (logger) {\n\t\t\tlogger.debug(`Open-Meteo Air Quality URL: ${airUrl}`);\n\t\t}\n\n\t\ttry {\n\t\t\tconst resA = await axios.get(airUrl, axiosConfig);\n\n\t\t\tif (logger) {\n\t\t\t\tlogger.debug(`Open-Meteo Air Quality Response Status: ${resA.status}`);\n\t\t\t}\n\n\t\t\tresults.air = resA.data;\n\t\t} catch (error: any) {\n\t\t\tif (logger) {\n\t\t\t\tlogger.warn(`Error retrieving air quality data: ${error.message}`);\n\t\t\t}\n\t\t\t// Luftqualit\u00E4t ist optional, daher kein throw\n\t\t}\n\t}\n\n\treturn results;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,mBAAkB;AAgClB,eAAsB,oBAAoB,QAAuB,QAAwC;AACxG,QAAM,KAAK,mBAAmB,OAAO,QAAQ;AAC7C,QAAM,UAAe,CAAC;AAGtB,QAAM,cAAc;AAAA,IACnB,SAAS;AAAA,IACT,SAAS;AAAA,MACR,YAAY;AAAA,IACb;AAAA,EACD;AAGA,QAAM,aAAa,OAAO,aACvB,6EACA;AAEH,MAAI,cAAc;AAClB,MAAI,mBAAmB;AAEvB,MAAI,OAAO,sBAAsB;AAChC,UAAM,aAAa,OAAO;AAC1B,kBAAc,mBAAmB,UAAU;AAC3C,uBAAmB;AAAA,EACpB;AACA,QAAM,oBACL;AAED,QAAM,kBACL;AAGD,QAAM,aAAa,mDAAmD,OAAO,QAAQ,cAAc,OAAO,SAAS,YAAY,iBAAiB,UAAU,eAAe,GAAG,gBAAgB,aAAa,EAAE,kBAAkB,OAAO,YAAY,GAAG,WAAW,GAAG,UAAU;AAE3Q,MAAI,QAAQ;AACX,WAAO,MAAM,2BAA2B,UAAU,EAAE;AAAA,EACrD;AAEA,MAAI;AACH,UAAM,OAAO,MAAM,aAAAA,QAAM,IAAI,YAAY,WAAW;AAEpD,QAAI,QAAQ;AACX,aAAO,MAAM,uCAAuC,KAAK,MAAM,EAAE;AAAA,IAClE;AAEA,YAAQ,UAAU,KAAK;AAEvB,QAAI,KAAK,KAAK,QAAQ;AACrB,cAAQ,SAAS,KAAK;AAAA,IACvB;AAAA,EACD,SAAS,OAAY;AACpB,QAAI,QAAQ;AACX,aAAO,MAAM,kCAAkC,MAAM,OAAO,EAAE;AAAA,IAC/D;AACA,UAAM,IAAI,MAAM,+BAA+B,MAAM,OAAO,EAAE;AAAA,EAC/D;AAEA,QAAM,mBACL;AACD,QAAM,0BAA0B,WAAW,gBAAgB;AAC3D,MAAI,OAAO,mBAAmB;AAC7B,UAAM,SAAS,kEAAkE,OAAO,QAAQ,cAAc,OAAO,SAAS,yBAAyB,gBAAgB,GAAG,uBAAuB,aAAa,EAAE,kBAAkB,OAAO,eAAe,IAAI,IAAI,OAAO,YAAY;AAEnR,QAAI,QAAQ;AACX,aAAO,MAAM,+BAA+B,MAAM,EAAE;AAAA,IACrD;AAEA,QAAI;AACH,YAAM,OAAO,MAAM,aAAAA,QAAM,IAAI,QAAQ,WAAW;AAEhD,UAAI,QAAQ;AACX,eAAO,MAAM,2CAA2C,KAAK,MAAM,EAAE;AAAA,MACtE;AAEA,cAAQ,MAAM,KAAK;AAAA,IACpB,SAAS,OAAY;AACpB,UAAI,QAAQ;AACX,eAAO,KAAK,sCAAsC,MAAM,OAAO,EAAE;AAAA,MAClE;AAAA,IAED;AAAA,EACD;AAEA,SAAO;AACR;",
  "names": ["axios"]
}
